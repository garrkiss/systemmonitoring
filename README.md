# Домашнее задание к занятию "`Введение в мониторинг`" - `Бакулев Евгений`

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя 
платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой 
осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы
выведите в мониторинг и почему?

Ответ: Загрузка процессора (CPU Usage), Нагрузка на память (Memory Usage), Задержка и время отклика по HTTP (HTTP Response Time), Частота ошибок HTTP-запросов (HTTP Error Rate), Дисковая активность (Disk I/O), Загруженность очередей задач (Queue Length / Job Queues)
#
2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, 
что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы 
можете ему предложить?

Ответ: Менеджеру продукта важно видеть метрики, которые отражают как состояние системы, так и качество обслуживания пользователей. Для этого можно предложить более понятные и ориентированные на конечный результат метрики. Время отклика системы, Доступность системы (Uptime / Availability), Частота ошибок (Error Rate), Производительность сервера
#
3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою 
очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, 
чтобы разработчики получали ошибки приложения?

Ответ: Использование OpenSource решений - Loki + Promtail + Grafana, ELK Stack (Elasticsearch, Logstash, Kibana), Graylog.  Использование облачных сервисов с бесплатным тарифом, локальное логирование и ручной сбор
#
4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. 
Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 
70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Ответ: Ошибка в расчетё SLA заключается в том, что формула summ_2xx_requests / summ_all_requests учитывает только успешные запросы (2xx) и все запросы, но не учитывает другие коды ответов, которые могут влиять на общее восприятие доступности сервиса
#

5. Опишите основные плюсы и минусы pull и push систем мониторинга.

Ответ: Pull система мониторинга: Плюсы: 1. Упрощение настройки на стороне агентов (агенты не инициируют соединение). 2. Лучший контроль за нагрузкой на устройствах (сервер контролирует частоту запросов). 3. Снижение риска избыточных данных (система запрашивает данные по необходимости). 4. Управление безопасностью (сервер мониторинга контролирует запросы). 5. Подходит для динамических систем, где данные изменяются со временем. Минусы: 1. Задержка в получении данных (зависит от интервала запросов). 2. Требуется настройка серверов и агентов для корректной работы. 3. Проблемы с сетевыми сбоями (если сервер не может достичь устройства). Push система мониторинга: Плюсы: 1. Минимальная задержка в получении данных (отправка в реальном времени). 2. Меньшая нагрузка на сервер мониторинга (агенты сами отправляют данные). 3. Удобство для распределенных и микросервисных систем. 4. Подходит для экстренных уведомлений о критических событиях. Минусы: 1. Избыточность данных (неправильно настроенные фильтры могут привести к избыточной передаче). 2. Повышенная нагрузка на устройства (необходимо постоянно отслеживать состояние). 3. Ограниченный контроль над частотой и объемом передаваемых данных. 4. Риски безопасности (неправильная настройка безопасности может привести к утечке данных).

#
6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

    - Prometheus  - Pull
    - TICK - Push, может и гибрид
    - Zabbix - Pull
    - VictoriaMetrics - Pull
    - Nagios - Pull 
#
7. Склонируйте себе [репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустите TICK-стэк, 
используя технологии docker и docker-compose.

В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`). 

P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим `Z`, например
`./data:/var/lib:Z`

Ответ
![Скриншот](https://github.com/garrkiss/systemmonitoring/blob/main/img/tick.png)

#
8. Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.
        
    - Нажмите на кнопку Add a query
    - Изучите вывод интерфейса и выберите БД telegraf.autogen
    - В `measurments` выберите cpu->host->telegraf-getting-started, а в `fields` выберите usage_system. Внизу появится график утилизации cpu.
    - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.

Для выполнения задания приведите скриншот с отображением метрик утилизации cpu из веб-интерфейса.

Ответ
![Скриншот](https://github.com/garrkiss/systemmonitoring/blob/main/img/%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%BA.png)

#
9. Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs). 
Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
```
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
```

Дополнительно вам может потребоваться донастройка контейнера telegraf в `docker-compose.yml` дополнительного volume и 
режима privileged:
```
  telegraf:
    image: telegraf:1.4.0
    privileged: true
    volumes:
      - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    links:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"
```

После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в 
веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.

Факультативно можете изучить какие метрики собирает telegraf после выполнения данного задания.

Ответ
![Скриншот](https://github.com/garrkiss/systemmonitoring/blob/main/img/image.png)